<!DOCTYPE html>
<html lang="pt-BR" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciador Financeiro</title>
    <link rel="stylesheet" href="src/css/style.css">
    <link rel="stylesheet" href="src/css/reset.css">
    <link rel="stylesheet" href="src/css/responsive.css">
</head>
<body>

    <div class="app-wrapper">
        <!-- NOVO CABE√áALHO SUPERIOR FIXO -->
        <header class="app-header">
            <div class="header-logo">
                <h2>Financeiro</h2>
            </div>
            <button class="hamburger-btn" aria-label="Abrir menu" aria-expanded="false">
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </button>
            <nav class="top-nav">
                <button class="nav-btn active" data-page="dashboard">In√≠cio</button>
                <button class="nav-btn" data-page="analise">An√°lise</button>
                <button class="nav-btn" data-page="orcamento">Or√ßamento</button>
                <button class="nav-btn" data-page="metas">Metas</button>
                <button class="nav-btn" data-page="investimentos">Investimentos</button>
            </nav>
            <div class="header-actions">
                <button id="toggle-values-btn" class="btn-theme" title="Ocultar/Mostrar Valores">üëÅÔ∏è</button>
                <button id="theme-toggle-btn" class="btn-theme" title="Alternar Tema">üåô</button>
            </div>
        </header>
        <!-- O container principal agora envolve tudo, exceto os modais -->
        <div class="container">
            <!-- Coluna Principal (agora chamada de main-content) -->
            <main class="main-content">
                <!-- Cada "p√°gina" corresponde a um item da navega√ß√£o inferior -->
                <div id="dashboard-page" class="page active">
                    <div class="page-header">
                        <h1>Dashboard</h1>
                        <div class="header-actions">
                        </div>
                    </div>
                    <!-- Container para os cards de balan√ßo -->
                    <div id="balanco-container-home" class="balanco-container-wrapper">
                        <div class="balanco-container">
                            <div class="card-balanco">
                                <div class="card-header">
                                    <h2><svg class="card-icon" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM12 6c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm0 10c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4z" fill="currentColor"/></svg> Saldo em Conta</h2>
                                </div>
                                <p id="saldoAtual">R$ 0,00</p>
                            </div>
                             <div class="card-balanco divida">
                                <div class="card-header">
                                    <h2><svg class="card-icon" viewBox="0 0 24 24"><path d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z" fill="currentColor"/></svg> D√≠vida Cart√£o</h2>
                                    <button id="btnPagarFatura" class="btn-pay-bill" title="Pagar Fatura">Pagar</button>
                                </div>
                                <p id="dividaCartao">R$ 0,00</p>
                            </div>
                            <div class="card-balanco">
                                <div class="card-header">
                                    <h2><svg class="card-icon" viewBox="0 0 24 24"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zm10 0c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2zm-1.45-5c.75 0 1.41-.41 1.75-1.03l3.58-6.49A.996.996 0 0020.01 4H5.21l-.94-2H1v2h2l3.6 7.59-1.35 2.44C8.52 15.37 9.2 16 10 16h9v-2h-9l1.1-2h7.45zM6.16 6h12.15l-2.76 5H8.53L6.16 6z" fill="currentColor"/></svg> Receitas do M√™s</h2>
                                </div>
                                <p id="receitasMes" class="positivo">R$ 0,00</p>
                            </div>
                            <div class="card-balanco">
                                <div class="card-header">
                                    <h2><svg class="card-icon" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM17 13H7v-2h10v2z" fill="currentColor"/></svg> Despesas do M√™s</h2>
                                </div>
                                <p id="despesasMes" class="negativo">R$ 0,00</p>
                            </div>
                        </div>
                    </div>
                    <!-- Se√ß√£o de Hist√≥rico de Transa√ß√µes -->
                    <div class="content-card">
                        <div class="historico-header">
                            <h2>Hist√≥rico de Transa√ß√µes</h2>
                            <div class="botoes-acao-cabecalho">
                                <button id="btnExportar" class="btn-exportar" title="Gera um relat√≥rio visual em HTML">Relat√≥rio (HTML)</button>
                                <button id="btnExportarCSV" class="btn-secondary" title="Gera uma planilha CSV para Excel">Excel (CSV)</button>
                                <button id="btnLimparTudo" class="btn-perigo">Limpar Tudo</button>
                            </div>
                        </div>
                        <div class="filtros-transacoes">
                            <button class="filtro-btn active" data-filter="all">Todos</button>
                            <button class="filtro-btn" data-filter="receita">Receitas</button>
                            <button class="filtro-btn" data-filter="despesa">Despesas</button>
                        </div>
                        <div class="search-container">
                            <input type="search" id="search-input" placeholder="üîé Pesquisar por descri√ß√£o...">
                        </div>
                        <div id="filtro-resumo" class="filtro-resumo hidden"></div>
                        <div class="transacoes-header">
                            <span class="col-data">Data</span>
                            <span class="col-descricao">Descri√ß√£o</span>
                            <span class="col-categoria">Categoria</span>
                            <span class="col-pagamento">Pagamento</span>
                            <span class="col-valor">Valor</span>
                            <span class="col-acoes">A√ß√µes</span>
                        </div>
                        <ul id="transacoesLista"></ul>
                        <div id="empty-state-message" class="empty-state">
                            <p>Nenhuma transa√ß√£o registrada ainda.</p>
                        </div>
                        <div id="historico-footer" class="historico-footer hidden">
                            <button id="btnMostrarMais" class="btn-secondary">Mostrar Mais</button>
                        </div>
                    </div>
                </div>

                <!-- P√°gina de An√°lise -->
                <div id="analise-page" class="page">
                    <div class="page-header"><h1>An√°lise Gr√°fica</h1></div>
                    <div id="analise-resumo" class="analise-resumo"></div>
                    <!-- Grid para os gr√°ficos de an√°lise -->
                    <div class="graficos-grid">
                        <div class="grafico-card">
                            <h3>üìä Despesas por Categoria</h3>
                            <div class="grafico-com-lista" id="despesas-chart-container">
                                <div class="grafico-container"><canvas id="despesasChart"></canvas></div>
                                <div id="despesas-lista-detalhada" class="lista-detalhada"></div>
                            </div>
                            <div id="despesas-chart-empty" class="chart-empty-state hidden"><p>Adicione despesas para ver a an√°lise.</p></div>
                        </div>
                        <div class="grafico-card">
                            <h3>üìà Receitas por Categoria</h3>
                            <div class="grafico-com-lista" id="receitas-chart-container">
                                <div class="grafico-container"><canvas id="receitasChart"></canvas></div>
                                <div id="receitas-lista-detalhada" class="lista-detalhada"></div>
                            </div>
                            <div id="receitas-chart-empty" class="chart-empty-state hidden"><p>Adicione receitas para ver a an√°lise.</p></div>
                        </div>
                        <div class="grafico-card grafico-grande">
                            <h3>üóìÔ∏è Receitas vs. Despesas por M√™s</h3>
                            <div class="grafico-container" id="saldo-evolucao-chart-container">
                                <canvas id="saldoEvolucaoChart"></canvas>
                            </div>
                            <div id="saldo-chart-empty" class="chart-empty-state hidden"><p>Adicione transa√ß√µes para ver a evolu√ß√£o do seu saldo.</p></div>
                        </div>
                    </div>
                </div>

                <!-- P√°gina de Or√ßamento -->
                <div id="orcamento-page" class="page">
                    <div class="page-header"><h1>Or√ßamento</h1></div>
                    <div class="content-card" style="margin-bottom: 30px;">
                        <h2>Definir Or√ßamentos Mensais</h2>
                        <p class="subtitulo-orcamento">Defina um limite de gastos para cada categoria. Os valores s√£o salvos automaticamente.</p>
                        <div id="orcamento-form-container" class="orcamento-form-grid"></div>
                    </div>
                    <div class="content-card">
                        <h2>üìä Acompanhamento do Or√ßamento</h2>
                        <p class="subtitulo-orcamento">Veja o progresso dos seus gastos em rela√ß√£o aos limites definidos.</p>
                        <div id="orcamento-progresso-container"></div>
                    </div>
                </div>

                <!-- P√°gina de Metas -->
                <div id="metas-page" class="page">
                    <div class="page-header"><h1>Metas Financeiras</h1></div>
                    <!-- Se√ß√£o de Metas -->
                    <div class="content-card" style="margin-bottom: 30px;">
                        <div class="metas-header">
                            <h2>üèÜ Suas Metas Financeiras</h2>
                            <div>
                                <button id="btnResetGoals" class="btn-secondary" title="Zerar o valor economizado de uma ou mais metas">Resetar Progresso</button>
                                <button class="btn-sucesso btn-criar-meta" data-goal-type="meta">+ Criar Nova Meta</button>
                            </div>
                        </div>
                        <p class="subtitulo-orcamento">Acompanhe o progresso da sua principal meta de economia.</p>
                        <div id="main-goal-placeholder"></div>
                        <div id="custom-metas-list" class="custom-goals-list"></div>
                    </div>
                </div>

                <!-- P√°gina de Investimentos (NOVA) -->
                <div id="investimentos-page" class="page">
                    <div class="page-header"><h1>Investimentos</h1></div>
                    <div class="content-card">
                        <div class="metas-header">
                            <h2>üí° Seus Investimentos</h2>
                            <button class="btn-sucesso btn-criar-meta" data-goal-type="investimento">+ Novo Investimento</button>
                        </div>
                        <p class="subtitulo-orcamento">Crie e acompanhe o progresso de seus investimentos de longo prazo.</p>
                        <div id="investments-list" class="custom-goals-list" style="margin-top: 0;"></div>
                    </div>
                    <div class="content-card">
                        <h2>üìä An√°lise de Investimentos</h2>
                        <div class="investimentos-grid">
                            <div class="grafico-card">
                                <h3>Distribui√ß√£o do Portf√≥lio</h3>
                                <div class="grafico-com-lista" id="investment-allocation-chart-container">
                                    <div class="grafico-container"><canvas id="investmentAllocationChart"></canvas></div>
                                    <div id="investment-allocation-lista-detalhada" class="lista-detalhada"></div>
                                </div>
                                <div id="investment-allocation-chart-empty" class="chart-empty-state hidden"><p>Adicione fundos para ver a aloca√ß√£o.</p></div>
                            </div>
                            <div class="grafico-card">
                                <h3>Progresso dos Investimentos</h3>
                                <div class="grafico-container" id="investments-chart-container"><canvas id="investmentsChart"></canvas></div>
                                <div id="investments-chart-empty" class="chart-empty-state hidden"><p>Crie investimentos para ver a an√°lise.</p></div>
                            </div>
                        </div>
                    </div>
                </div>

            </main>
        </div>

    </div>

    <!-- Template para item de transa√ß√£o -->
    <template id="transacao-template">
        <li>
            <span class="col-data"></span>
            <div class="transacao-info">
                <span class="col-descricao"></span>
                <div class="tag-categoria-mobile"></div>
            </div>
            <span class="col-categoria"></span>
            <span class="col-pagamento"></span>
            <span class="col-valor"></span>
            <div class="col-acoes">
                <button class="edit-btn" title="Editar">‚úèÔ∏è</button>
                <button class="delete-btn" title="Excluir">üóëÔ∏è</button>
            </div>
        </li>
    </template>

    <!-- Componentes de UI (Notifica√ß√£o e Modal) -->
    <div id="notification-container" class="notification-container" role="alert" aria-live="assertive"></div>
    <div id="confirmation-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="confirmation-message">Confirma√ß√£o Necess√°ria</h3>
            </div>
            <div class="modal-footer">
                <button id="confirm-btn-cancel" class="btn-secondary">Cancelar</button>
                <button id="confirm-btn-ok" class="btn-perigo">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- BOT√ÉO FLUTUANTE PARA ADICIONAR (MOBILE) -->
    <button id="open-add-transaction-modal" class="fab" title="Adicionar Transa√ß√£o">+</button>

    <div class="nav-overlay hidden"></div>
    <!-- MODAL PARA ADICIONAR TRANSA√á√ÉO (MOBILE) -->
    <div id="add-transaction-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <!-- O formul√°rio ser√° clonado aqui via JS -->
        </div>
    </div>

    <!-- TEMPLATE DO FORMUL√ÅRIO DE TRANSA√á√ÉO (para ser clonado) -->
    <template id="form-template">
        <section class="formulario-transacao" aria-labelledby="form-title">
            <div class="modal-header">
                <h2 id="form-title">Adicionar Transa√ß√£o</h2>
                <button class="close-modal-btn">&times;</button>
            </div>
            <form id="formTransacao">
                <div class="form-group">
                    <label>Descri√ß√£o</label>
                    <input type="text" id="descricao" class="form-input-descricao" placeholder="Ex: Sal√°rio, Aluguel" required aria-required="true">
                </div>
                <div class="form-group">
                    <label>Valor (use v√≠rgula para centavos)</label>
                    <input type="text" id="valor" class="form-input-valor" placeholder="0,00" required aria-required="true" inputmode="decimal">
                </div>
                <div class="form-group">
                    <div class="label-with-button">
                        <label>Categoria</label>
                        <button type="button" class="btn-manage-categories" title="Gerenciar Categorias">‚öôÔ∏è</button>
                    </div>
                    <select id="categoria" class="form-input-categoria"></select>
                    <input type="text" id="categoria-outra" class="form-input-categoria-outra hidden" placeholder="Digite a nova categoria" style="margin-top: 10px;">
                </div>
                <!-- Fieldsets e bot√µes ser√£o adicionados aqui via JS -->
            </form>
        </section>
    </template>

    <!-- Modal para Pagar Fatura -->
    <div id="pay-bill-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Pagar Fatura do Cart√£o</h3>
                <p>O valor ser√° debitado do seu saldo em conta para abater a d√≠vida do cart√£o.</p>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="valor-fatura">Valor do Pagamento</label>
                    <input type="text" id="valor-fatura" placeholder="0,00" required>
                </div>
            </div>
            <div class="modal-footer">
                <button id="pay-bill-btn-cancel" class="btn-secondary">Cancelar</button>
                <button id="pay-bill-btn-ok" class="btn-sucesso">Confirmar Pagamento</button>
            </div>
        </div>
    </div>

    <!-- Modal para Definir Meta -->
    <div id="set-goal-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Editar Meta Principal</h3>
                <p>Defina o nome e o valor da sua meta principal.</p>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="main-goal-name">Nome da Meta</label>
                    <input type="text" id="main-goal-name" placeholder="Ex: Economia do M√™s" required>
                </div>
                <div class="form-group">
                    <label for="valor-meta">Valor da Meta</label>
                    <input type="text" id="valor-meta" placeholder="0,00" required inputmode="decimal">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary">Cancelar</button>
                <button id="set-goal-btn-ok" class="btn-sucesso">Salvar Meta</button>
            </div>
        </div>
    </div>

    <!-- Modal para Criar Meta Personalizada -->
    <div id="create-goal-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Criar Nova Meta</h3>
                <p>Defina um objetivo e o valor que voc√™ precisa economizar.</p>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="goal-name">Nome da Meta</label>
                    <input type="text" id="goal-name" placeholder="Ex: Viagem para a praia" required>
                </div>
                <div class="form-group">
                    <label for="goal-target-value">Valor Alvo</label>
                    <input type="text" id="goal-target-value" placeholder="0,00" required inputmode="decimal">
                </div>
                <!-- Novo campo para editar o valor salvo -->
                <div class="form-group hidden" id="goal-saved-value-group">
                    <label for="goal-saved-value">Valor Atual (Salvo/Investido)</label>
                    <input type="text" id="goal-saved-value" placeholder="0,00" inputmode="decimal">
                </div>
                <!-- Novo campo para Categoria do Investimento -->
                <div class="form-group hidden" id="goal-category-group">
                    <label for="goal-category">Categoria do Investimento</label>
                    <select id="goal-category">
                        <!-- As op√ß√µes ser√£o populadas dinamicamente via JS -->
                    </select>
                    <input type="text" id="goal-category-other" class="hidden" placeholder="Digite a categoria" style="margin-top: 10px;">
                </div>
            </div>
            <div class="modal-footer">
                <button id="delete-goal-from-modal-btn" class="btn-perigo hidden">Excluir Meta</button>
                <button class="btn-secondary">Cancelar</button>
                <button id="create-goal-btn-ok" class="btn-sucesso">Salvar Meta</button>
            </div>
        </div>
    </div>

    <!-- Modal para Adicionar Fundos a uma Meta -->
    <div id="add-to-goal-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Adicionar Fundos √† Meta</h3>
                <p id="add-to-goal-message">O valor ser√° debitado do seu saldo e adicionado √† meta.</p>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="add-to-goal-value">Valor a Adicionar</label>
                    <input type="text" id="add-to-goal-value" placeholder="0,00" required inputmode="decimal">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary">Cancelar</button>
                <button id="add-to-goal-btn-ok" class="btn-sucesso">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Modal para Resetar Progresso de Metas -->
    <div id="reset-goals-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Resetar Progresso da Meta</h3>
                <p>Selecione as metas cujo progresso de economia voc√™ deseja zerar.</p>
            </div>
            <div class="modal-body">
                <div id="reset-goals-list" class="goals-selection-list">
                    <!-- A lista de metas ser√° inserida aqui via JS -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary">Cancelar</button>
                <button id="reset-goals-btn-ok" class="btn-perigo">Confirmar Reset</button>
            </div>
        </div>
    </div>

    <!-- Modal para Gerenciar Categorias -->
    <div id="manage-categories-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Gerenciar Categorias de Transa√ß√£o</h3>
                <p>Adicione, edite ou remova categorias. A exclus√£o n√£o afetar√° transa√ß√µes existentes.</p>
            </div>
            <div class="modal-body">
                <ul id="category-manager-list" class="category-manager-list">
                    <!-- Categorias ser√£o inseridas aqui via JS -->
                </ul>
                <div class="add-category-form">
                    <input type="text" id="new-category-name-input" placeholder="Adicionar nova categoria">
                    <button id="add-new-category-btn" class="btn-sucesso">+</button>
                </div>
            </div>
            <div class="modal-footer">
                <button id="manage-categories-btn-close" class="btn-secondary">Fechar</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="src/js/transaction.js"></script>
    <script src="src/js/javascript.js"></script>
</body>
</html>